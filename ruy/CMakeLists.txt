# Copyright 2021 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Do not edit! This file was auto-generated by this program:
#   cmake/bazel_to_cmake.py . ruy
# To regenerate CMakeLists.txt for all subdirectories, just run:
#   cmake/bazel_to_cmake.sh

if(CMAKE_SYSTEM_NAME STREQUAL Windows)
  # nothing goes into RUY_SELECT_ruy_0
else()
  set(RUY_SELECT_ruy_0 "-Wall;-Wextra;-Wc++14-compat;-Wundef")
endif()

if(CMAKE_SYSTEM_PROCESSOR STREQUAL arm)
  set(RUY_SELECT_ruy_1 "-mfpu=neon")
else()
  set(RUY_SELECT_ruy_1 "")
endif()

if(TRUE)
  # nothing goes into RUY_SELECT_ruy_2
else()
  set(RUY_SELECT_ruy_2 "-O3")
endif()

cc_library(
  NAME
    ruy_platform
  HDRS
    platform.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
)

cc_library(
  NAME
    ruy_gtest_wrapper
  TESTONLY
  HDRS
    gtest_wrapper.h
  DEPS
    gtest
)

cc_library(
  NAME
    ruy_check_macros
  HDRS
    check_macros.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
)

cc_test(
  NAME
    ruy_check_macros_test
  SRCS
    check_macros_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
    ruy_gtest_wrapper
)

cc_library(
  NAME
    ruy_opt_set
  HDRS
    opt_set.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
)

cc_library(
  NAME
    ruy_time
  HDRS
    time.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
)

if(CMAKE_SYSTEM_NAME STREQUAL Windows)
  # nothing goes into RUY_SELECT_ruy_3
else()
  set(RUY_SELECT_ruy_3 "-pthread")
endif()

cc_library(
  NAME
    ruy_wait
  SRCS
    wait.cc
  HDRS
    wait.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  LINKOPTS
    ${RUY_SELECT_ruy_3}
  DEPS
    ruy_time
)

cc_test(
  NAME
    ruy_wait_test
  SRCS
    wait_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  LINKOPTS
    ${RUY_SELECT_ruy_3}
  DEPS
    ruy_gtest_wrapper
    ruy_platform
    ruy_wait
)

cc_library(
  NAME
    ruy_size_util
  HDRS
    size_util.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
)

cc_test(
  NAME
    ruy_size_util_test
  SRCS
    size_util_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_gtest_wrapper
    ruy_size_util
)

cc_library(
  NAME
    ruy_tune
  SRCS
    tune.cc
  HDRS
    tune.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_cpu_cache_params
    ruy_cpuinfo
    ruy_opt_set
    ruy_platform
    ruy_time
)

cc_library(
  NAME
    ruy_system_aligned_alloc
  SRCS
    system_aligned_alloc.cc
  HDRS
    system_aligned_alloc.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
)

cc_library(
  NAME
    ruy_prepacked_cache
  SRCS
    prepacked_cache.cc
  HDRS
    prepacked_cache.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_mat
    ruy_system_aligned_alloc
    ruy_profiler_instrumentation
)

cc_test(
  NAME
    ruy_tune_test
  SRCS
    tune_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_cpuinfo
    ruy_gtest_wrapper
    ruy_tune
)

cc_test(
  NAME
    ruy_prepacked_cache_test
  SRCS
    prepacked_cache_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_context
    ruy_context_get_ctx
    ruy_ctx
    ruy_gtest_wrapper
    ruy_mat
    ruy_matrix
    ruy_prepacked_cache
    ruy_ruy
    ruy_time
)

cc_library(
  NAME
    ruy_allocator
  SRCS
    allocator.cc
  HDRS
    allocator.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_opt_set
    ruy_size_util
    ruy_system_aligned_alloc
)

cc_test(
  NAME
    ruy_allocator_test
  SRCS
    allocator_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_allocator
    ruy_gtest_wrapper
)

cc_library(
  NAME
    ruy_side_pair
  HDRS
    side_pair.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
)

cc_library(
  NAME
    ruy_block_map
  SRCS
    block_map.cc
  HDRS
    block_map.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
    ruy_cpu_cache_params
    ruy_opt_set
    ruy_side_pair
    ruy_size_util
    ruy_profiler_instrumentation
)

cc_test(
  NAME
    ruy_block_map_test
  SRCS
    block_map_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_block_map
    ruy_cpu_cache_params
    ruy_gtest_wrapper
    ruy_path
    ruy_platform
    ruy_side_pair
)

cc_library(
  NAME
    ruy_blocking_counter
  SRCS
    blocking_counter.cc
  HDRS
    blocking_counter.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  LINKOPTS
    ${RUY_SELECT_ruy_3}
  DEPS
    ruy_check_macros
    ruy_time
    ruy_wait
)

cc_library(
  NAME
    ruy_thread_pool
  SRCS
    thread_pool.cc
  HDRS
    thread_pool.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  LINKOPTS
    ${RUY_SELECT_ruy_3}
  PUBLIC
  DEPS
    ruy_blocking_counter
    ruy_check_macros
    ruy_time
    ruy_wait
)

cc_library(
  NAME
    ruy_cpu_cache_params
  HDRS
    cpu_cache_params.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
)

if(CMAKE_SYSTEM_NAME STREQUAL Windows)
  # nothing goes into RUY_SELECT_ruy_4
else()
  set(RUY_SELECT_ruy_4 "-Wno-undef")
endif()

if(CMAKE_SYSTEM_PROCESSOR STREQUAL ppc64 OR CMAKE_SYSTEM_PROCESSOR STREQUAL ppc64le)
  # nothing goes into RUY_SELECT_ruy_5
elseif(CMAKE_SYSTEM_PROCESSOR STREQUAL s390 OR CMAKE_SYSTEM_PROCESSOR STREQUAL s390x)
  # nothing goes into RUY_SELECT_ruy_5
elseif(CMAKE_SYSTEM_NAME STREQUAL Fuchsia)
  # nothing goes into RUY_SELECT_ruy_5
else()
  set(RUY_SELECT_ruy_5 "-DRUY_HAVE_CPUINFO")
endif()

if(CMAKE_SYSTEM_PROCESSOR STREQUAL ppc64 OR CMAKE_SYSTEM_PROCESSOR STREQUAL ppc64le)
  # nothing goes into RUY_SELECT_ruy_6
elseif(CMAKE_SYSTEM_PROCESSOR STREQUAL s390 OR CMAKE_SYSTEM_PROCESSOR STREQUAL s390x)
  # nothing goes into RUY_SELECT_ruy_6
elseif(CMAKE_SYSTEM_NAME STREQUAL Fuchsia)
  # nothing goes into RUY_SELECT_ruy_6
else()
  set(RUY_SELECT_ruy_6 "cpuinfo")
endif()

cc_library(
  NAME
    ruy_cpuinfo
  SRCS
    cpuinfo.cc
  HDRS
    cpuinfo.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_4}
    ${RUY_SELECT_ruy_5}
  DEPS
    ruy_platform
    ruy_check_macros
    ruy_cpu_cache_params
    ${RUY_SELECT_ruy_6}
)

cc_library(
  NAME
    ruy_path
  HDRS
    path.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  PUBLIC
  DEPS
    ruy_platform
    ruy_size_util
)

cc_library(
  NAME
    ruy_performance_advisory
  HDRS
    performance_advisory.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  PUBLIC
)

cc_library(
  NAME
    ruy_matrix
  HDRS
    matrix.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  PUBLIC
  DEPS
    ruy_check_macros
)

cc_test(
  NAME
    ruy_matrix_test
  SRCS
    matrix_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_gtest_wrapper
    ruy_matrix
)

cc_library(
  NAME
    ruy_mul_params
  HDRS
    mul_params.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  PUBLIC
  DEPS
    ruy_check_macros
    ruy_size_util
)

cc_test(
  NAME
    ruy_mul_params_test
  SRCS
    mul_params_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_gtest_wrapper
    ruy_mul_params
)

cc_library(
  NAME
    ruy_mat
  HDRS
    mat.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
    ruy_matrix
    ruy_size_util
)

cc_library(
  NAME
    ruy_asm_helpers
  HDRS
    asm_helpers.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_opt_set
)

cc_library(
  NAME
    ruy_apply_multiplier
  SRCS
    apply_multiplier.cc
  HDRS
    apply_multiplier.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
    ruy_mul_params
)

cc_test(
  NAME
    ruy_apply_multiplier_test
  SRCS
    apply_multiplier_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_apply_multiplier
    ruy_gtest_wrapper
    ruy_mul_params
)

cc_library(
  NAME
    ruy_kernel_common
  HDRS
    kernel_common.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_apply_multiplier
    ruy_check_macros
    ruy_mat
    ruy_matrix
    ruy_mul_params
    ruy_opt_set
    ruy_path
    ruy_platform
    ruy_side_pair
    ruy_size_util
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_pack_common
  HDRS
    pack_common.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
    ruy_mat
    ruy_matrix
    ruy_opt_set
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_kernel_arm
  SRCS
    kernel_arm32.cc
    kernel_arm64.cc
  HDRS
    kernel_arm.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_asm_helpers
    ruy_check_macros
    ruy_kernel_common
    ruy_mat
    ruy_mul_params
    ruy_opt_set
    ruy_path
    ruy_platform
    ruy_side_pair
    ruy_size_util
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_pack_arm
  SRCS
    pack_arm.cc
  HDRS
    pack_arm.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_asm_helpers
    ruy_check_macros
    ruy_mat
    ruy_opt_set
    ruy_pack_common
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

if((CMAKE_SYSTEM_PROCESSOR STREQUAL x86_64 OR CMAKE_SYSTEM_PROCESSOR STREQUAL amd64) AND NOT MSVC)
  set(RUY_SELECT_ruy_7 ";-mavx512f;-mavx512vl;-mavx512cd;-mavx512bw;-mavx512dq")
elseif(MSVC)
  set(RUY_SELECT_ruy_7 "/arch:AVX512")
else()
  set(RUY_SELECT_ruy_7 "")
endif()

cc_library(
  NAME
    ruy_kernel_avx512
  SRCS
    kernel_avx512.cc
  HDRS
    kernel_x86.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_7}
  DEPS
    ruy_check_macros
    ruy_kernel_common
    ruy_mat
    ruy_mul_params
    ruy_opt_set
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_pack_avx512
  SRCS
    pack_avx512.cc
  HDRS
    pack_x86.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_7}
  DEPS
    ruy_check_macros
    ruy_mat
    ruy_opt_set
    ruy_pack_common
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_have_built_path_for_avx512
  SRCS
    have_built_path_for_avx512.cc
  HDRS
    have_built_path_for.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_7}
  DEPS
    ruy_opt_set
    ruy_platform
)

if((CMAKE_SYSTEM_PROCESSOR STREQUAL x86_64 OR CMAKE_SYSTEM_PROCESSOR STREQUAL amd64) AND NOT MSVC)
  set(RUY_SELECT_ruy_8 "-mavx2;-mfma")
elseif(MSVC)
  set(RUY_SELECT_ruy_8 "/arch:AVX2")
else()
  set(RUY_SELECT_ruy_8 "")
endif()

cc_library(
  NAME
    ruy_kernel_avx2_fma
  SRCS
    kernel_avx2_fma.cc
  HDRS
    kernel_x86.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_8}
  DEPS
    ruy_check_macros
    ruy_kernel_common
    ruy_mat
    ruy_mul_params
    ruy_opt_set
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_pack_avx2_fma
  SRCS
    pack_avx2_fma.cc
  HDRS
    pack_x86.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_8}
  DEPS
    ruy_check_macros
    ruy_mat
    ruy_opt_set
    ruy_pack_common
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_have_built_path_for_avx2_fma
  SRCS
    have_built_path_for_avx2_fma.cc
  HDRS
    have_built_path_for.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_8}
  DEPS
    ruy_opt_set
    ruy_platform
)

if((CMAKE_SYSTEM_PROCESSOR STREQUAL x86_64 OR CMAKE_SYSTEM_PROCESSOR STREQUAL amd64) AND NOT MSVC)
  set(RUY_SELECT_ruy_9 "-mavx")
elseif(MSVC)
  set(RUY_SELECT_ruy_9 "/arch:AVX")
else()
  set(RUY_SELECT_ruy_9 "")
endif()

cc_library(
  NAME
    ruy_kernel_avx
  SRCS
    kernel_avx.cc
  HDRS
    kernel_x86.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_9}
  DEPS
    ruy_check_macros
    ruy_kernel_common
    ruy_mat
    ruy_mul_params
    ruy_opt_set
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_pack_avx
  SRCS
    pack_avx.cc
  HDRS
    pack_x86.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_9}
  DEPS
    ruy_check_macros
    ruy_mat
    ruy_opt_set
    ruy_pack_common
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_have_built_path_for_avx
  SRCS
    have_built_path_for_avx.cc
  HDRS
    have_built_path_for.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    ${RUY_SELECT_ruy_9}
  DEPS
    ruy_opt_set
    ruy_platform
)

cc_library(
  NAME
    ruy_kernel
  HDRS
    kernel.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_apply_multiplier
    ruy_check_macros
    ruy_kernel_arm
    ruy_kernel_avx
    ruy_kernel_avx2_fma
    ruy_kernel_avx512
    ruy_kernel_common
    ruy_mat
    ruy_matrix
    ruy_mul_params
    ruy_opt_set
    ruy_path
    ruy_platform
    ruy_side_pair
    ruy_size_util
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_pack
  HDRS
    pack.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
    ruy_mat
    ruy_matrix
    ruy_opt_set
    ruy_pack_arm
    ruy_pack_avx
    ruy_pack_avx2_fma
    ruy_pack_avx512
    ruy_pack_common
    ruy_path
    ruy_platform
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_have_built_path_for
  HDRS
    have_built_path_for.h
  DEPS
    ruy_have_built_path_for_avx
    ruy_have_built_path_for_avx2_fma
    ruy_have_built_path_for_avx512
    ruy_platform
)

cc_library(
  NAME
    ruy_context
  SRCS
    context.cc
  HDRS
    context.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  PUBLIC
  DEPS
    ruy_allocator
    ruy_check_macros
    ruy_ctx
    ruy_have_built_path_for
    ruy_path
    ruy_performance_advisory
    ruy_platform
    ruy_prepacked_cache
    ruy_thread_pool
    ruy_tune
)

cc_test(
  NAME
    ruy_context_test
  SRCS
    context_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_context
    ruy_gtest_wrapper
    ruy_path
    ruy_platform
    ruy_prepacked_cache
    ruy_tune
)

cc_library(
  NAME
    ruy_ctx_header_only_should_not_include_other_ruy_headers
  TESTONLY
  HDRS
    ctx.h
)

cc_library(
  NAME
    ruy_ctx
  SRCS
    ctx.cc
  HDRS
    ctx.h
    ctx_impl.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_allocator
    ruy_check_macros
    ruy_cpuinfo
    ruy_have_built_path_for
    ruy_path
    ruy_performance_advisory
    ruy_platform
    ruy_prepacked_cache
    ruy_thread_pool
    ruy_tune
)

cc_library(
  NAME
    ruy_context_get_ctx
  SRCS
    context_get_ctx.cc
  HDRS
    context_get_ctx.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_context
    ruy_ctx
)

cc_test(
  NAME
    ruy_ctx_test
  SRCS
    ctx_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_ctx
    ruy_gtest_wrapper
    ruy_path
    ruy_platform
)

cc_library(
  NAME
    ruy_trmul_params
  HDRS
    trmul_params.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_mat
    ruy_mul_params
    ruy_path
    ruy_side_pair
    ruy_tune
)

cc_library(
  NAME
    ruy_trmul
  SRCS
    trmul.cc
  HDRS
    trmul.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_allocator
    ruy_block_map
    ruy_check_macros
    ruy_cpu_cache_params
    ruy_cpuinfo
    ruy_ctx
    ruy_mat
    ruy_matrix
    ruy_mul_params
    ruy_opt_set
    ruy_side_pair
    ruy_size_util
    ruy_thread_pool
    ruy_trmul_params
    ruy_tune
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_prepare_packed_matrices
  SRCS
    prepare_packed_matrices.cc
  HDRS
    prepare_packed_matrices.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_allocator
    ruy_ctx
    ruy_matrix
    ruy_prepacked_cache
    ruy_side_pair
    ruy_trmul_params
)

cc_library(
  NAME
    ruy_create_trmul_params
  HDRS
    create_trmul_params.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_allocator
    ruy_check_macros
    ruy_ctx
    ruy_kernel
    ruy_mat
    ruy_mul_params
    ruy_pack
    ruy_path
    ruy_performance_advisory
    ruy_platform
    ruy_side_pair
    ruy_trmul_params
)

cc_library(
  NAME
    ruy_validate
  HDRS
    validate.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
    ruy_mat
    ruy_mul_params
    ruy_side_pair
)

cc_library(
  NAME
    ruy_frontend
  SRCS
    frontend.cc
  HDRS
    frontend.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_allocator
    ruy_create_trmul_params
    ruy_ctx
    ruy_mat
    ruy_mul_params
    ruy_prepare_packed_matrices
    ruy_trmul
    ruy_trmul_params
    ruy_validate
    ruy_profiler_instrumentation
)

cc_library(
  NAME
    ruy_ruy
  HDRS
    ruy.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  PUBLIC
  DEPS
    ruy_context
    ruy_context_get_ctx
    ruy_frontend
    ruy_mat
    ruy_matrix
    ruy_mul_params
    ruy_path
)

cc_test(
  NAME
    ruy_perchannel_buffers_reallocation_test
  SRCS
    perchannel_buffers_reallocation_test.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_context
    ruy_gtest_wrapper
    ruy_kernel
    ruy_matrix
    ruy_path
    ruy_performance_advisory
    ruy_ruy
)

cc_library(
  NAME
    ruy_pmu
  TESTONLY
  SRCS
    pmu.cc
  HDRS
    pmu.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEPS
    ruy_check_macros
)

cc_library(
  NAME
    ruy_reference_mul
  HDRS
    reference_mul.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  PUBLIC
  DEPS
    ruy_apply_multiplier
    ruy_matrix
    ruy_mul_params
)

if(CMAKE_SYSTEM_NAME STREQUAL Windows)
  # nothing goes into RUY_SELECT_ruy_10
else()
  set(RUY_SELECT_ruy_10 "-lm")
endif()

cc_library(
  NAME
    ruy_test_lib
  TESTONLY
  HDRS
    test.h
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
  DEFINES
  LINKOPTS
    ${RUY_SELECT_ruy_10}
  DEPS
    ruy_allocator
    ruy_size_util
    ruy_reference_mul
    ruy_matrix
    ruy_pmu
    ruy_ruy
    ruy_mul_params
    ruy_time
    ruy_gtest_wrapper
    ruy_platform
    ruy_context
    ruy_ctx
    ruy_context_get_ctx
    ruy_pack_common
    ruy_profiler_profiler
)

cc_binary(
  NAME
    ruy_benchmark_f32_f32_f32_f32
  TESTONLY
  SRCS
    benchmark.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=f32
    -DRUY_TEST_RHSSCALAR=f32
    -DRUY_TEST_ACCUMSCALAR=f32
    -DRUY_TEST_DSTSCALAR=f32
  DEPS
    ruy_test_lib
    ruy_profiler_instrumentation
  TAGS
    req_dep=//third_party/gemmlowp:profiler
)

cc_binary(
  NAME
    ruy_benchmark_u8_u8_i32_u8
  TESTONLY
  SRCS
    benchmark.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=u8
    -DRUY_TEST_RHSSCALAR=u8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=u8
  DEPS
    ruy_test_lib
    ruy_profiler_instrumentation
  TAGS
    req_dep=//third_party/gemmlowp:profiler
)

cc_binary(
  NAME
    ruy_benchmark_i8_i8_i32_u8
  TESTONLY
  SRCS
    benchmark.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=i8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=u8
  DEPS
    ruy_test_lib
    ruy_profiler_instrumentation
  TAGS
    req_dep=//third_party/gemmlowp:profiler
)

cc_binary(
  NAME
    ruy_benchmark_i8_i8_i32_i8
  TESTONLY
  SRCS
    benchmark.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=i8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i8
  DEPS
    ruy_test_lib
    ruy_profiler_instrumentation
  TAGS
    req_dep=//third_party/gemmlowp:profiler
)

cc_binary(
  NAME
    ruy_benchmark_u8_u8_i32_i16
  TESTONLY
  SRCS
    benchmark.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=u8
    -DRUY_TEST_RHSSCALAR=u8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i16
  DEPS
    ruy_test_lib
    ruy_profiler_instrumentation
  TAGS
    req_dep=//third_party/gemmlowp:profiler
)

cc_binary(
  NAME
    ruy_benchmark_i8_i8_i32_i32
  TESTONLY
  SRCS
    benchmark.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=i8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i32
  DEPS
    ruy_test_lib
    ruy_profiler_instrumentation
  TAGS
    req_dep=//third_party/gemmlowp:profiler
)

cc_test(
  NAME
    ruy_test_fast_f32_f32_f32_f32
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=f32
    -DRUY_TEST_RHSSCALAR=f32
    -DRUY_TEST_ACCUMSCALAR=f32
    -DRUY_TEST_DSTSCALAR=f32
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_fast_f64_f32_f64_f32
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=f64
    -DRUY_TEST_RHSSCALAR=f32
    -DRUY_TEST_ACCUMSCALAR=f64
    -DRUY_TEST_DSTSCALAR=f32
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_fast_f32_f64_f64_f64
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=f32
    -DRUY_TEST_RHSSCALAR=f64
    -DRUY_TEST_ACCUMSCALAR=f64
    -DRUY_TEST_DSTSCALAR=f64
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_fast_u8_u8_i32_u8
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=u8
    -DRUY_TEST_RHSSCALAR=u8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=u8
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_fast_i8_i8_i32_i8
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=i8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i8
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_fast_i8_u8_i32_i8
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=u8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i8
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_fast_u8_u8_i32_i16
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=u8
    -DRUY_TEST_RHSSCALAR=u8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i16
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_fast_i8_i8_i32_i32
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=i8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i32
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_fast_i8_u8_i32_i32
  SRCS
    test_fast.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=u8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i32
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
)

cc_test(
  NAME
    ruy_test_slow_f32_f32_f32_f32
  SRCS
    test_slow.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=f32
    -DRUY_TEST_RHSSCALAR=f32
    -DRUY_TEST_ACCUMSCALAR=f32
    -DRUY_TEST_DSTSCALAR=f32
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
    slow
)

cc_test(
  NAME
    ruy_test_slow_u8_u8_i32_u8
  SRCS
    test_slow.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=u8
    -DRUY_TEST_RHSSCALAR=u8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=u8
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
    slow
)

cc_test(
  NAME
    ruy_test_slow_i8_i8_i32_i8
  SRCS
    test_slow.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=i8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i8
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
    slow
)

cc_test(
  NAME
    ruy_test_slow_u8_u8_i32_i16
  SRCS
    test_slow.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=u8
    -DRUY_TEST_RHSSCALAR=u8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i16
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
    slow
)

cc_test(
  NAME
    ruy_test_slow_i8_i8_i32_i32
  SRCS
    test_slow.cc
  COPTS
    ${RUY_SELECT_ruy_0}
    ${RUY_SELECT_ruy_1}
    ${RUY_SELECT_ruy_2}
    -DRUY_TEST_LHSSCALAR=i8
    -DRUY_TEST_RHSSCALAR=i8
    -DRUY_TEST_ACCUMSCALAR=i32
    -DRUY_TEST_DSTSCALAR=i32
  DEPS
    ruy_test_lib
    gtest_main
  TAGS
    slow
)



add_all_subdirs()

